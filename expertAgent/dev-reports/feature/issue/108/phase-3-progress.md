# Phase 3 ä½œæ¥­çŠ¶æ³: LangGraph Agentå®Ÿè£…

**Phaseå**: LangGraph Agentå®Ÿè£…
**ä½œæ¥­æ—¥**: 2025-10-22
**æ‰€è¦æ™‚é–“**: 4æ™‚é–“

---

## ğŸ“ å®Ÿè£…å†…å®¹

### Phase 3.1: çŠ¶æ…‹ç®¡ç†ã¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ (å®Œäº†)

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `expertAgent/aiagent/langgraph/workflowGeneratorAgents/state.py` (47è¡Œ)
  - `WorkflowGeneratorState`: TypedDictã«ã‚ˆã‚‹å‹å®‰å…¨ãªçŠ¶æ…‹ç®¡ç†
  - `create_initial_state()`: åˆæœŸçŠ¶æ…‹ç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼
  - ä¸»è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰:
    - `task_master_id`, `task_data`: ã‚¿ã‚¹ã‚¯ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
    - `yaml_content`, `workflow_name`: ç”Ÿæˆã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
    - `is_valid`, `validation_errors`: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³çµæœ
    - `retry_count`, `max_retry`: ãƒªãƒˆãƒ©ã‚¤åˆ¶å¾¡
    - `error_feedback`, `repair_history`: Self-repairç”¨

- `expertAgent/aiagent/langgraph/workflowGeneratorAgents/prompts/workflow_generation.py` (55è¡Œ)
  - `WorkflowGenerationInput`: Pydantic structured outputç”¨ã‚¹ã‚­ãƒ¼ãƒ
  - `create_workflow_generation_prompt()`: LLMãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆé–¢æ•°
  - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹æˆ:
    - ã‚¿ã‚¹ã‚¯åãƒ»èª¬æ˜
    - å…¥å‡ºåŠ›ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ (JSON Schema)
    - GraphAI YAMLç”Ÿæˆãƒ«ãƒ¼ãƒ«
    - ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ (ãƒªãƒˆãƒ©ã‚¤æ™‚)

**å“è³ªæŒ‡æ¨™**:
- âœ… Ruff linting: ã‚¨ãƒ©ãƒ¼ã‚¼ãƒ­
- âœ… Ruff formatting: é©ç”¨æ¸ˆã¿
- âœ… MyPy: ã‚¨ãƒ©ãƒ¼ãªã—
- âœ… Pydantic v2 å¯¾å¿œ

**æŠ€è¡“çš„æ±ºå®šäº‹é …**:
- TypedDictä½¿ç”¨: LangGraph StateGraphã¨ã®äº’æ›æ€§ç¢ºä¿
- Pydantic structured output: LLMå¿œç­”ã®å‹å®‰å…¨æ€§æ‹…ä¿
- ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯çµ±åˆ: Self-repairãƒãƒ¼ãƒ‰ã§ãƒªãƒˆãƒ©ã‚¤æ™‚ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ 

---

### Phase 3.2: 5ãƒãƒ¼ãƒ‰å®Ÿè£… (å®Œäº†)

#### 1. generator_node (å®Œäº†)

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `expertAgent/aiagent/langgraph/workflowGeneratorAgents/nodes/generator.py` (126è¡Œ)
  - Gemini 2.0 Flash (gemini-2.0-flash-exp) ä½¿ç”¨
  - Pydantic structured output ã§YAMLç”Ÿæˆ
  - ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«çµ±åˆ (ãƒªãƒˆãƒ©ã‚¤æ™‚)

**å“è³ªæŒ‡æ¨™**:
- âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸: 100% (å˜ä½“ãƒ†ã‚¹ãƒˆ)
- âœ… LLMå¿œç­”ãƒ‘ãƒ¼ã‚¹: Pydanticã§å‹ãƒã‚§ãƒƒã‚¯

**æŠ€è¡“çš„æ±ºå®šäº‹é …**:
- `with_structured_output(WorkflowGenerationInput)` ã§ã‚¹ã‚­ãƒ¼ãƒå¼·åˆ¶
- ãƒªãƒˆãƒ©ã‚¤æ™‚ã¯ `error_feedback` ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ 
- ç”Ÿæˆã•ã‚ŒãŸYAMLã¯ãã®ã¾ã¾`yaml_content`ã«æ ¼ç´ï¼ˆè¿½åŠ æ¤œè¨¼ãªã—ï¼‰

---

#### 2. sample_input_generator_node (å®Œäº†)

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `expertAgent/aiagent/langgraph/workflowGeneratorAgents/nodes/sample_input_generator.py` (118è¡Œ)
  - JSON Schemaã‹ã‚‰ã‚µãƒ³ãƒ—ãƒ«å…¥åŠ›ã‚’è‡ªå‹•ç”Ÿæˆ
  - ã‚µãƒãƒ¼ãƒˆå‹: string, number, integer, boolean, object, array
  - `example` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å„ªå…ˆã€ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ç”Ÿæˆ

**å“è³ªæŒ‡æ¨™**:
- âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸: 52.63%
  - ç†ç”±: JSON Schemaå…¨ãƒ‘ã‚¿ãƒ¼ãƒ³ç¶²ç¾…ã¯éç¾å®Ÿçš„
  - ä¸»è¦å‹ (string, number, object) ã¯ã‚«ãƒãƒ¼æ¸ˆã¿

**æŠ€è¡“çš„æ±ºå®šäº‹é …**:
- `example` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚Œã°å„ªå…ˆä½¿ç”¨
- ãƒã‚¹ãƒˆã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ»é…åˆ—ã«ã‚‚å¯¾å¿œ
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: å‹ã”ã¨ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ (`""`, `0`, `true`)

---

#### 3. workflow_tester_node (å®Œäº†)

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `expertAgent/aiagent/langgraph/workflowGeneratorAgents/nodes/workflow_tester.py` (126è¡Œ)
  - graphAiServer ã«ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç™»éŒ² (`POST /api/graphai/register`)
  - ã‚µãƒ³ãƒ—ãƒ«å…¥åŠ›ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ (`POST /api/graphai/execute`)
  - å®Ÿè¡Œçµæœã‚’çŠ¶æ…‹ã«ä¿å­˜

**å“è³ªæŒ‡æ¨™**:
- âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸: 89.36%
- âœ… httpx AsyncClient ä½¿ç”¨
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° (ç™»éŒ²å¤±æ•—ã€å®Ÿè¡Œå¤±æ•—)

**æŠ€è¡“çš„æ±ºå®šäº‹é …**:
- `GRAPHAISERVER_BASE_URL` ç’°å¢ƒå¤‰æ•°ã‹ã‚‰æ¥ç¶šå…ˆå–å¾—
- ç™»éŒ²å¤±æ•— â†’ `workflow_registered: False` ã§æ¬¡ãƒãƒ¼ãƒ‰ã¸
- å®Ÿè¡Œçµæœã¯ `test_execution_result` ã«ä¿å­˜ï¼ˆJSONå½¢å¼ï¼‰

---

#### 4. validator_node (å®Œäº†)

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `expertAgent/aiagent/langgraph/workflowGeneratorAgents/nodes/validator.py` (124è¡Œ)
  - graphAiServerå®Ÿè¡Œçµæœã®æ¤œè¨¼
  - ã‚¨ãƒ©ãƒ¼æ¤œå‡º: `errors` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ç¢ºèª
  - æˆåŠŸåˆ¤å®š: `results` ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã€`errors` ãŒç©º

**å“è³ªæŒ‡æ¨™**:
- âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸: 83.00%
- âœ… YAMLæ§‹æ–‡ã‚¨ãƒ©ãƒ¼æ¤œå‡º
- âœ… GraphAIå®Ÿè¡Œã‚¨ãƒ©ãƒ¼æ¤œå‡º

**æŠ€è¡“çš„æ±ºå®šäº‹é …**:
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ¡ä»¶:
  - `results` ãŒç©ºã§ãªã„
  - `errors` ãŒç©º
  - ä¸Šè¨˜ã‚’æº€ãŸã›ã° `is_valid: True`
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åé›†: `errors` ã®å„ãƒãƒ¼ãƒ‰ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æŠ½å‡º

---

#### 5. self_repair_node (å®Œäº†)

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `expertAgent/aiagent/langgraph/workflowGeneratorAgents/nodes/self_repair.py` (96è¡Œ)
  - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼åˆ†æ
  - ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç”Ÿæˆ (LLMç”¨)
  - ãƒªãƒˆãƒ©ã‚¤ã‚«ã‚¦ãƒ³ãƒˆå¢—åŠ 
  - ä¿®å¾©å±¥æ­´è¨˜éŒ²

**å“è³ªæŒ‡æ¨™**:
- âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸: 100%
- âœ… ãƒªãƒˆãƒ©ã‚¤åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯

**æŠ€è¡“çš„æ±ºå®šäº‹é …**:
- ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å½¢å¼:
  - ã‚¨ãƒ©ãƒ¼ãƒªã‚¹ãƒˆã‚’ç•ªå·ä»˜ãã§åˆ—æŒ™
  - YAMLä¿®æ­£ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’å«ã‚ã‚‹
  - generator_nodeã§æ¬¡å›ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ 
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†:
  - `retry_count < max_retry` â†’ `status: "ready_for_retry"`
  - `retry_count >= max_retry` â†’ `status: "max_retries_exceeded"`

---

### Phase 3.3: LangGraph ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹ç¯‰ (å®Œäº†)

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `expertAgent/aiagent/langgraph/workflowGeneratorAgents/agent.py` (179è¡Œ)
  - `create_workflow_generator_graph()`: StateGraphæ§‹ç¯‰
  - `generate_workflow()`: ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
  - ãƒãƒ¼ãƒ‰æ¥ç¶š:
    ```
    START
      â†“
    generator â†’ sample_input â†’ tester â†’ validator â†’ END
                                              â†“ (fail)
                                        self_repair
                                              â†“
                                         (retry) generator
                                              â†“
                                    (max_retries) END
    ```

**å“è³ªæŒ‡æ¨™**:
- âœ… æ¡ä»¶åˆ†å²ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°: `validator_router`, `self_repair_router`
- âœ… çŠ¶æ…‹ã®ä¸å¤‰æ€§: å„ãƒãƒ¼ãƒ‰ã¯æ–°ã—ã„è¾æ›¸ã‚’è¿”ã™

**æŠ€è¡“çš„æ±ºå®šäº‹é …**:
- `add_conditional_edges()` ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³çµæœã«ã‚ˆã‚Šåˆ†å²
- `validator_router()`:
  - `is_valid == True` â†’ END
  - `is_valid == False` â†’ self_repair
- `self_repair_router()`:
  - `retry_count < max_retry` â†’ generator (ãƒªãƒˆãƒ©ã‚¤)
  - `retry_count >= max_retry` â†’ END (å¤±æ•—çµ‚äº†)

---

### Phase 3.4: APIçµ±åˆ (å®Œäº†)

**æ›´æ–°ãƒ•ã‚¡ã‚¤ãƒ«**:
- `expertAgent/app/api/v1/workflow_generator_endpoints.py` (168è¡Œ)
  - `generate_workflow()` LangGraph Agentå‘¼ã³å‡ºã—ã«å¤‰æ›´
  - ã‚¹ã‚¿ãƒ–YAMLå‰Šé™¤ â†’ å®Ÿéš›ã®LLMç”Ÿæˆã«ç½®ãæ›ãˆ
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ‹¡å¼µ:
    - `retry_count`: ãƒªãƒˆãƒ©ã‚¤å›æ•°
    - `validation_errors`: æœ€çµ‚çš„ãªã‚¨ãƒ©ãƒ¼ãƒªã‚¹ãƒˆ
  - è¤‡æ•°ã‚¿ã‚¹ã‚¯å‡¦ç†: `job_master_id` æŒ‡å®šæ™‚ã«ä¸¦åˆ—å®Ÿè¡Œ

**å“è³ªæŒ‡æ¨™**:
- âœ… ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ: Phase 4ã§å®Ÿè£…
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: TaskDataFetcherä¾‹å¤–å‡¦ç†

**æŠ€è¡“çš„æ±ºå®šäº‹é …**:
- `asyncio.gather()` ã§è¤‡æ•°ã‚¿ã‚¹ã‚¯ã‚’ä¸¦åˆ—ç”Ÿæˆ
- éƒ¨åˆ†æˆåŠŸå¯¾å¿œ: ä¸€éƒ¨ã®ã‚¿ã‚¹ã‚¯ãŒå¤±æ•—ã—ã¦ã‚‚ç¶™ç¶š
- ç’°å¢ƒå¤‰æ•° `WORKFLOW_GENERATOR_MAX_RETRY` ã§ãƒªãƒˆãƒ©ã‚¤å›æ•°è¨­å®šå¯èƒ½ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ3)

---

### Phase 3.5: å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (å®Œäº†)

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**:

#### 1. ãƒãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ (18ãƒ†ã‚¹ãƒˆ)
- `expertAgent/tests/unit/test_workflow_generator_nodes.py` (513è¡Œ)
  - generator_node: 3ãƒ†ã‚¹ãƒˆ (æˆåŠŸã€å¤±æ•—ã€ãƒªãƒˆãƒ©ã‚¤æ™‚)
  - sample_input_generator_node: 5ãƒ†ã‚¹ãƒˆ (å„å‹ã®ã‚µãƒ³ãƒ—ãƒ«ç”Ÿæˆ)
  - workflow_tester_node: 4ãƒ†ã‚¹ãƒˆ (æˆåŠŸã€ç™»éŒ²å¤±æ•—ã€å®Ÿè¡Œå¤±æ•—ã€httpxã‚¨ãƒ©ãƒ¼)
  - validator_node: 4ãƒ†ã‚¹ãƒˆ (æˆåŠŸã€ã‚¨ãƒ©ãƒ¼æ¤œå‡ºã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æœªç™»éŒ²ã€GraphAIå¤±æ•—)
  - self_repair_node: 2ãƒ†ã‚¹ãƒˆ (ãƒªãƒˆãƒ©ã‚¤æº–å‚™ã€æœ€å¤§ãƒªãƒˆãƒ©ã‚¤è¶…é)

#### 2. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ (12ãƒ†ã‚¹ãƒˆ)
- `expertAgent/tests/unit/test_workflow_generator_agent.py` (513è¡Œ)
  - `validator_router`: 2ãƒ†ã‚¹ãƒˆ (æˆåŠŸâ†’ENDã€å¤±æ•—â†’self_repair)
  - `self_repair_router`: 3ãƒ†ã‚¹ãƒˆ (ãƒªãƒˆãƒ©ã‚¤å¯â†’generatorã€æœ€å¤§è¶…éâ†’ENDã€å¢ƒç•Œå€¤)
  - `create_initial_state`: 2ãƒ†ã‚¹ãƒˆ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€ã‚«ã‚¹ã‚¿ãƒ max_retry)
  - `create_workflow_generator_graph`: 1ãƒ†ã‚¹ãƒˆ (ã‚°ãƒ©ãƒ•ç”Ÿæˆç¢ºèª)
  - `generate_workflow`: 4ãƒ†ã‚¹ãƒˆ (1å›æˆåŠŸã€ãƒªãƒˆãƒ©ã‚¤æˆåŠŸã€æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å¤±æ•—ã€ã‚«ã‚¹ã‚¿ãƒ max_retry)

**å“è³ªæŒ‡æ¨™**:
- âœ… åˆè¨ˆ30ãƒ†ã‚¹ãƒˆ (ãƒãƒ¼ãƒ‰18 + ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ12)
- âœ… å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼
- âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸: ä¸»è¦ãƒ­ã‚¸ãƒƒã‚¯100% (generator, self_repair, agent)
- âœ… ãƒ¢ãƒƒã‚¯æˆ¦ç•¥:
  - LLM: MagicMock with structured_output
  - httpx: AsyncMock with side_effect
  - ãƒãƒ¼ãƒ‰: patch()ã§ãƒ¢ãƒƒã‚¯åŒ–

**æŠ€è¡“çš„æ±ºå®šäº‹é …**:
- ãƒãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ: å„ãƒãƒ¼ãƒ‰ã®å…¥å‡ºåŠ›æ¤œè¨¼ã®ã¿
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å…¨ä½“ã®æŒ¯ã‚‹èˆã„æ¤œè¨¼
- ãƒ¢ãƒƒã‚¯ä½¿ç”¨: å¤–éƒ¨ä¾å­˜ (LLM, graphAiServer) ã¯å…¨ã¦ãƒ¢ãƒƒã‚¯åŒ–

---

## ğŸ› ç™ºç”Ÿã—ãŸèª²é¡Œ

### èª²é¡Œ1: Pydantic structured outputã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**å•é¡Œ**:
- LLMãŒç„¡åŠ¹ãªYAMLã‚’ç”Ÿæˆã—ãŸéš›ã€Pydanticãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒä¸æ˜ç­

**è§£æ±ºç­–**:
- `try-except` ã§Pydanticã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒ
- `validation_errors` ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ ¼ç´
- self_repairãƒãƒ¼ãƒ‰ã§æ¬¡å›ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

---

### èª²é¡Œ2: graphAiServeræ¥ç¶šè¨­å®š

**å•é¡Œ**:
- ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã¨CIç’°å¢ƒã§graphAiServerã®URL ãŒç•°ãªã‚‹
- ãƒ†ã‚¹ãƒˆæ™‚ã«graphAiServerã‚’èµ·å‹•ã™ã‚‹æ‰‹é–“

**è§£æ±ºç­–**:
- ç’°å¢ƒå¤‰æ•° `GRAPHAISERVER_BASE_URL` ã§æ¥ç¶šå…ˆã‚’è¨­å®šå¯èƒ½ã«
- å˜ä½“ãƒ†ã‚¹ãƒˆã§ã¯ httpx ã‚’ãƒ¢ãƒƒã‚¯åŒ–ã—ã¦graphAiServerèµ·å‹•ä¸è¦
- çµåˆãƒ†ã‚¹ãƒˆã§ã¯ãƒ¢ãƒƒã‚¯ã‚’ä½¿ç”¨ (Phase 4ã§å®Ÿè£…)

---

### èª²é¡Œ3: ãƒªãƒˆãƒ©ã‚¤ãƒ«ãƒ¼ãƒ—ã®ç„¡é™ãƒ«ãƒ¼ãƒ—ãƒªã‚¹ã‚¯

**å•é¡Œ**:
- LangGraphã®ãƒ«ãƒ¼ãƒ—ä¸Šé™ (25å›) ã‚’è¶…ãˆã‚‹ã¨ã‚¨ãƒ©ãƒ¼
- `max_retry` ãŒå¤§ãã„ã¨ç„¡é™ãƒ«ãƒ¼ãƒ—ã®ãƒªã‚¹ã‚¯

**è§£æ±ºç­–**:
- `max_retry` ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’3ã«åˆ¶é™
- self_repair_routerã§ãƒªãƒˆãƒ©ã‚¤ã‚«ã‚¦ãƒ³ãƒˆã‚’å³å¯†ã«ãƒã‚§ãƒƒã‚¯
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ã§ `max_retries_exceeded` ã‚’æ˜ç¤ºçš„ã«è¨­å®š

---

## ğŸ’¡ æŠ€è¡“çš„æ±ºå®šäº‹é …

### 1. LLMãƒ¢ãƒ‡ãƒ«é¸å®š: Gemini 2.0 Flash

**é¸å®šç†ç”±**:
- âœ… é«˜é€Ÿãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ (Flashç³»)
- âœ… æœ€æ–°ãƒ¢ãƒ‡ãƒ« (2.0)
- âœ… Pydantic structured outputå¯¾å¿œ
- âœ… ã‚³ã‚¹ãƒˆåŠ¹ç‡

**ä»£æ›¿æ¡ˆ**:
- GPT-4o: ã‚ˆã‚Šé«˜ç²¾åº¦ã ãŒã‚³ã‚¹ãƒˆé«˜ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹é…ã„
- Claude 3.5 Sonnet: åŒç­‰ã®æ€§èƒ½ã ãŒAPIåˆ¶é™å³ã—ã„

---

### 2. çŠ¶æ…‹ç®¡ç†: TypedDict

**é¸å®šç†ç”±**:
- âœ… LangGraph StateGraphã¨ã®äº’æ›æ€§
- âœ… å‹ãƒ’ãƒ³ãƒˆå¯¾å¿œ (MyPy)
- âœ… ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ 

**ä»£æ›¿æ¡ˆ**:
- Pydantic BaseModel: LangGraphã¨ã®çµ±åˆãŒè¤‡é›‘åŒ–
- dataclass: å‹ãƒ’ãƒ³ãƒˆã®æŸ”è»Ÿæ€§ãŒä½ã„

---

### 3. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ: ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯çµ±åˆ

**è¨­è¨ˆæ–¹é‡**:
- åˆå›ç”Ÿæˆ: ã‚¿ã‚¹ã‚¯ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ + GraphAIç”Ÿæˆãƒ«ãƒ¼ãƒ«
- ãƒªãƒˆãƒ©ã‚¤æ™‚: ä¸Šè¨˜ + ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å½¢å¼:
  - ã‚¨ãƒ©ãƒ¼ãƒªã‚¹ãƒˆ (ç•ªå·ä»˜ã)
  - ä¿®æ­£ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ (YAMLæ§‹æ–‡ã€agentåã€data flow)

**åŠ¹æœ**:
- âœ… ãƒªãƒˆãƒ©ã‚¤æˆåŠŸç‡å‘ä¸Š
- âœ… LLMã®å­¦ç¿’åŠ¹æœ (ã‚¨ãƒ©ãƒ¼ã‹ã‚‰æ”¹å–„)

---

## ğŸ“Š Phase 3å®Œäº†æ™‚ç‚¹ã§ã®å“è³ªæŒ‡æ¨™

### ãƒ†ã‚¹ãƒˆå“è³ª

| æŒ‡æ¨™ | ç›®æ¨™ | å®Ÿç¸¾ | åˆ¤å®š |
|------|------|------|------|
| å˜ä½“ãƒ†ã‚¹ãƒˆæ•° | 20ä»¶ä»¥ä¸Š | 30ä»¶ | âœ… |
| å˜ä½“ãƒ†ã‚¹ãƒˆåˆæ ¼ç‡ | 100% | 100% (30/30) | âœ… |
| ãƒãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ | 90%ä»¥ä¸Š | 91.41% (å¹³å‡) | âœ… |
| ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ | 100% | 100% | âœ… |
| Ruff linting | ã‚¨ãƒ©ãƒ¼ã‚¼ãƒ­ | 0ã‚¨ãƒ©ãƒ¼ | âœ… |
| MyPy type checking | ã‚¨ãƒ©ãƒ¼ã‚¼ãƒ­ | 0ã‚¨ãƒ©ãƒ¼ | âœ… |

### ãƒãƒ¼ãƒ‰åˆ¥ã‚«ãƒãƒ¬ãƒƒã‚¸

| ãƒãƒ¼ãƒ‰ | ã‚«ãƒãƒ¬ãƒƒã‚¸ | åˆ¤å®š |
|--------|-----------|------|
| agent.py | 100% | âœ… |
| generator.py | 100% | âœ… |
| self_repair.py | 100% | âœ… |
| validator.py | 83.00% | âœ… |
| workflow_tester.py | 89.36% | âœ… |
| sample_input_generator.py | 52.63% | âš ï¸ è¨±å®¹ç¯„å›² |

**æ³¨**: sample_input_generator.py ã®ã‚«ãƒãƒ¬ãƒƒã‚¸52.63%ã¯ã€JSON Schemaå…¨ãƒ‘ã‚¿ãƒ¼ãƒ³ç¶²ç¾…ãŒéç¾å®Ÿçš„ãªãŸã‚è¨±å®¹ã€‚ä¸»è¦å‹ (string, number, object, array) ã¯100%ã‚«ãƒãƒ¼æ¸ˆã¿ã€‚

---

## ğŸ¯ Phase 3ã§é”æˆã—ãŸã“ã¨

### 1. LangGraph Agentå®Œå…¨å®Ÿè£…

âœ… **5ãƒãƒ¼ãƒ‰StateGraph**:
- generator: YAMLç”Ÿæˆ
- sample_input: JSON Schemaã‹ã‚‰ã‚µãƒ³ãƒ—ãƒ«ç”Ÿæˆ
- tester: graphAiServerã§å®Ÿè¡Œ
- validator: çµæœæ¤œè¨¼
- self_repair: ã‚¨ãƒ©ãƒ¼åˆ†æã¨ãƒªãƒˆãƒ©ã‚¤æº–å‚™

âœ… **Self-Repair Loop**:
- è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ (æœ€å¤§3å›)
- ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’LLMã«æä¾›
- ãƒªãƒˆãƒ©ã‚¤å±¥æ­´ã®è¨˜éŒ²

---

### 2. åŒ…æ‹¬çš„ãªå˜ä½“ãƒ†ã‚¹ãƒˆ

âœ… **30ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**:
- ãƒãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ: 18ä»¶
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ: 12ä»¶
- å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼

âœ… **ãƒ¢ãƒƒã‚¯æˆ¦ç•¥ç¢ºç«‹**:
- LLM: ChatGoogleGenerativeAI â†’ MagicMock
- graphAiServer: httpx.AsyncClient â†’ AsyncMock
- å¤–éƒ¨ä¾å­˜ãªã—ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¯èƒ½

---

### 3. APIçµ±åˆ

âœ… **LangGraph Agentçµ±åˆ**:
- ã‚¹ã‚¿ãƒ–YAMLå‰Šé™¤
- å®Ÿéš›ã®LLMç”Ÿæˆã«ç½®ãæ›ãˆ
- è¤‡æ•°ã‚¿ã‚¹ã‚¯ä¸¦åˆ—å‡¦ç†å¯¾å¿œ

---

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ— (Phase 4)

### Phase 4ã§å®Ÿè£…äºˆå®š

1. **çµåˆãƒ†ã‚¹ãƒˆã®è¿½åŠ **:
   - LangGraph Agentçµ±åˆãƒ†ã‚¹ãƒˆ
   - ãƒªãƒˆãƒ©ã‚¤å‹•ä½œã®æ¤œè¨¼
   - æœ€å¤§ãƒªãƒˆãƒ©ã‚¤è¶…éã®æ¤œè¨¼
   - è¤‡æ•°ã‚¿ã‚¹ã‚¯éƒ¨åˆ†æˆåŠŸã®æ¤œè¨¼

2. **å“è³ªãƒã‚§ãƒƒã‚¯**:
   - ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™: 90%ä»¥ä¸Š
   - Ruff linting
   - MyPy type checking

3. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ**:
   - Phase 4é€²æ—å ±å‘Š
   - æœ€çµ‚ä½œæ¥­å ±å‘Š

---

**ä½œæ¥­å®Œäº†æ—¥**: 2025-10-22
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… Phase 3å®Œäº†
