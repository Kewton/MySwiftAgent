# Phase 2 ãƒ†ã‚¹ãƒˆçµæœãƒ¬ãƒãƒ¼ãƒˆ

**å®Ÿæ–½æ—¥**: 2025-10-20
**å¯¾è±¡ãƒ–ãƒ©ãƒ³ãƒ**: `feature/issue/97`
**Phase**: Phase 2ï¼ˆjobqueue APIãƒ¬ã‚¹ãƒãƒ³ã‚¹çµ±ä¸€å¾Œï¼‰
**ä¿®æ­£å†…å®¹**: jobqueue APIã®3ã¤ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ã‚­ãƒ¼ãƒã« `id` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 

---

## ğŸ“‹ ãƒ†ã‚¹ãƒˆæ¦‚è¦

Phase 2ã§å®Ÿæ–½ã—ãŸjobqueue APIä¿®æ­£ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ çµ±ä¸€ï¼‰ã®åŠ¹æœã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã€3ã¤ã®ã‚·ãƒŠãƒªã‚ªã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚

### ãƒ†ã‚¹ãƒˆç’°å¢ƒ

| é …ç›® | è¨­å®šå€¤ |
|------|--------|
| **expertAgent** | http://localhost:8104 |
| **jobqueue** | http://localhost:8101 |
| **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ** | 600ç§’ï¼ˆ10åˆ†ï¼‰ |
| **max_retry** | 5 |
| **LLMãƒ¢ãƒ‡ãƒ«** | Claude Haiku 4.5 |
| **max_tokens** | 8192 |

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã¨çµæœ

### Scenario 1: ä¼æ¥­åˆ†æãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

**è¦æ±‚**: ã€Œä¼æ¥­åã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ãã®ä¼æ¥­ã®éå»ï¼•å¹´ã®å£²ã‚Šä¸Šã’ã¨ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ã®å¤‰åŒ–ã‚’ã¾ã¨ã‚ã¦ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã™ã‚‹ã€

#### çµæœã‚µãƒãƒªãƒ¼

| é …ç›® | çµæœ |
|------|------|
| **HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹** | âœ… 200 OK |
| **å®Ÿè¡Œæ™‚é–“** | 144.36ç§’ï¼ˆç´„2åˆ†24ç§’ï¼‰ |
| **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼çŠ¶æ…‹** | âš ï¸ failed |
| **åˆ°é”ãƒ•ã‚§ãƒ¼ã‚º** | **interface_definition** |
| **ã‚¿ã‚¹ã‚¯åˆ†è§£** | âœ… æˆåŠŸï¼ˆ10ã‚¿ã‚¹ã‚¯ç”Ÿæˆï¼‰ |
| **KeyError: 'id'** | âœ… **è§£æ¶ˆï¼ˆPhase 2ã®ä¿®æ­£ã«ã‚ˆã‚Šï¼‰** |

#### è©³ç´°åˆ†æ

**âœ… Phase 2ã®æˆæœç¢ºèª**:
- expertAgentã¯ **interface_definitionæ®µéšã¾ã§åˆ°é”**
- Phase 1ã§ç™ºç”Ÿã—ã¦ã„ãŸ `KeyError: 'id'` ã¯ **è§£æ¶ˆã•ã‚ŒãŸ**
- jobqueue APIã® `InterfaceMaster` ä½œæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒ **æ­£å¸¸ã«é€ä¿¡ã•ã‚ŒãŸ**

**âŒ æ–°ãŸã«ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ**:
```
Interface definition failed: Jobqueue API error (400):
{"detail":"Invalid input_schema: Schema error: \"^[\\\\p{L}\\\\p{N}\\\\s\\\\-\\\\.\\\\'\\\\(\\\\)&]+$\" is not a 'regex'"}
```

**å•é¡Œã®è©³ç´°**:
- jobqueue APIã®JSON Schema V7ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§Regexã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
- LLMãŒç”Ÿæˆã—ãŸRegexãƒ‘ã‚¿ãƒ¼ãƒ³ã« **4é‡ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—** ãŒå«ã¾ã‚Œã¦ã„ã‚‹
- Phase 1ã§ä¿®æ­£ã—ãŸPromptï¼ˆ`interface_schema.py`ï¼‰ãŒååˆ†ã«æ©Ÿèƒ½ã—ã¦ã„ãªã„å¯èƒ½æ€§

**ç”Ÿæˆã•ã‚ŒãŸã‚¿ã‚¹ã‚¯**ï¼ˆ10ã‚¿ã‚¹ã‚¯ï¼‰:
1. ä¼æ¥­åå…¥åŠ›ã¨æ¤œè¨¼
2. ä¼æ¥­ã®å£²ä¸Šãƒ‡ãƒ¼ã‚¿æ¤œç´¢ï¼ˆè¤‡æ•°ã‚¯ã‚¨ãƒªï¼‰
3. ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«å¤‰åŒ–æƒ…å ±æ¤œç´¢ï¼ˆè¤‡æ•°ã‚¯ã‚¨ãƒªï¼‰
4. å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã®åˆ†æã¨å¯è¦–åŒ–
5. ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«å¤‰åŒ–ã®åˆ†æã¨è¦ç´„
6. ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆHTMLå½¢å¼ï¼‰
7. ãƒ¡ãƒ¼ãƒ«é€ä¿¡å…ˆã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›ã¨æ¤œè¨¼
8. ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã®ä½œæˆ
9. ãƒ¡ãƒ¼ãƒ«é€ä¿¡
10. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒªãƒˆãƒ©ã‚¤

---

### Scenario 2: PDFæŠ½å‡ºã¨Google Driveã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

**è¦æ±‚**: ã€ŒæŒ‡å®šã—ãŸWebã‚µã‚¤ãƒˆã‹ã‚‰PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŠ½å‡ºã—ã€Google Driveã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã€ãƒ¡ãƒ¼ãƒ«ã§é€šçŸ¥ã—ã¾ã™ã€

#### çµæœã‚µãƒãƒªãƒ¼

| é …ç›® | çµæœ |
|------|------|
| **HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹** | âŒ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ |
| **å®Ÿè¡Œæ™‚é–“** | 600.01ç§’ï¼ˆ10åˆ†ï¼‰ |
| **åˆ°é”ãƒ•ã‚§ãƒ¼ã‚º** | ä¸æ˜ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰ |

#### è©³ç´°åˆ†æ

**åŸå› æ¨æ¸¬**:
1. **LLMãƒ¢ãƒ‡ãƒ«ã®å‡¦ç†æ™‚é–“**:
   - `max_tokens=8192` ã«ã‚ˆã‚‹ç”Ÿæˆæ™‚é–“ã®å¢—åŠ 
   - è¤‡é›‘ãªè¦æ±‚ï¼ˆPDFæŠ½å‡º + Google Drive + ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ï¼‰ã«ã‚ˆã‚‹å‡¦ç†è² è·

2. **å‰æ®µéšã§ã®åœæ­¢**:
   - requirement_analysis ã¾ãŸã¯ task_breakdown ã§ã®æ™‚é–“è¶…é
   - LLMã¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒé•·å¤§åŒ–ã—ã¦ã„ã‚‹å¯èƒ½æ€§

3. **expertAgentã®å†…éƒ¨ã‚¨ãƒ©ãƒ¼**:
   - interface_definitionä»¥å‰ã®æ®µéšã§ä¾‹å¤–ãŒç™ºç”Ÿ
   - ãƒ­ã‚°å‡ºåŠ›ä¸è¶³ã«ã‚ˆã‚Šè©³ç´°ä¸æ˜

**jobqueueãƒ­ã‚°ã®ç¢ºèª**:
- jobqueueã«ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå±Šã„ã¦ã„ãªã„
- expertAgentãŒå‰æ®µéšã§åœæ­¢ã—ã¦ã„ã‚‹

---

### Scenario 3: Newsletteræ¤œç´¢ã¨MP3å¤‰æ›

**è¦æ±‚**: ã€ŒThis workflow searches for a newsletter in Gmail using a keyword, summarizes it, converts it to an MP3 podcastã€

#### çµæœã‚µãƒãƒªãƒ¼

| é …ç›® | çµæœ |
|------|------|
| **HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹** | âŒ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ |
| **å®Ÿè¡Œæ™‚é–“** | 600.01ç§’ï¼ˆ10åˆ†ï¼‰ |
| **åˆ°é”ãƒ•ã‚§ãƒ¼ã‚º** | ä¸æ˜ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰ |

#### è©³ç´°åˆ†æ

Scenario 2ã¨åŒæ§˜ã®åŸå› ã§ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚

**ç‰¹å¾´**:
- è‹±èªã®è¦æ±‚ï¼ˆè‹±èª â†’ æ—¥æœ¬èªã®Promptå‡¦ç†ï¼‰
- è¤‡æ•°ã®APIé€£æºï¼ˆGmail + Summarization + MP3å¤‰æ›ï¼‰
- expertAgentãŒå‰æ®µéšã§åœæ­¢

---

## ğŸ“Š Phase 2 ä¿®æ­£ã®åŠ¹æœæ¸¬å®š

### âœ… é”æˆäº‹é …

| é …ç›® | Phase 1 | Phase 2 | åˆ¤å®š |
|------|---------|---------|------|
| **KeyError: 'id' ç™ºç”Ÿ** | âŒ ç™ºç”Ÿ | âœ… è§£æ¶ˆ | **æ”¹å–„** |
| **interface_definitionåˆ°é”** | âŒ æœªåˆ°é” | âœ… åˆ°é” | **æ”¹å–„** |
| **å®Ÿè¡Œæ™‚é–“ï¼ˆScenario 1ï¼‰** | 2åˆ†44ç§’ | 2åˆ†24ç§’ | **æ”¹å–„** |
| **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Œäº†** | âŒ å¤±æ•— | âŒ å¤±æ•— | æœªæ”¹å–„ |

### ğŸ¯ Phase 2ã®æˆæœ

1. **âœ… æ ¹æœ¬åŸå› ã®è§£æ±º**:
   - `KeyError: 'id'` ã‚’å®Œå…¨ã«è§£æ¶ˆ
   - jobqueue APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ã‚’çµ±ä¸€
   - å¾Œæ–¹äº’æ›æ€§ã‚’ä¿ã¡ãªãŒã‚‰ä¿®æ­£

2. **âœ… interface_definitionæ®µéšã¾ã§åˆ°é”**:
   - Phase 1ã§ã¯ `KeyError` ã§åœæ­¢ã—ã¦ã„ãŸæ®µéšã‚’çªç ´
   - InterfaceMasterä½œæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ­£å¸¸ã«é€ä¿¡ã•ã‚ŒãŸ

3. **âœ… å®Ÿè¡Œæ™‚é–“ã®æ”¹å–„**:
   - Scenario 1: 2åˆ†44ç§’ â†’ 2åˆ†24ç§’ï¼ˆç´„13%çŸ­ç¸®ï¼‰
   - `id` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ¬ å¦‚ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å‰Šæ¸›

---

## âš ï¸ æ®‹å­˜ã™ã‚‹èª²é¡Œ

### èª²é¡Œ1: Regexéå‰°ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å•é¡Œï¼ˆå„ªå…ˆåº¦: ğŸ”´ é«˜ï¼‰

**å•é¡Œ**:
```
"^[\\\\p{L}\\\\p{N}\\\\s\\\\-\\\\.\\\\'\\\\(\\\\)&]+$" is not a 'regex'
```

**åŸå› **:
- LLMãŒJSONæ–‡å­—åˆ—å†…ã®Regexãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’4é‡ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã§ç”Ÿæˆ
- Phase 1ã§ `interface_schema.py` ã®Promptã‚’ä¿®æ­£ã—ãŸãŒã€ä¸ååˆ†

**å¯¾ç­–æ¡ˆï¼ˆPhase 3ï¼‰**:
1. **Promptæ”¹å–„**:
   - ã‚ˆã‚Šæ˜ç¢ºãªã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ä¾‹ã‚’è¿½åŠ 
   - èª¤ã£ãŸä¾‹ã‚’æ˜ç¤ºçš„ã«ç¦æ­¢

2. **Responseå¾Œå‡¦ç†**:
   - LLMå‡ºåŠ›å¾Œã€Regexãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è‡ªå‹•ä¿®æ­£
   - 4é‡ã‚¨ã‚¹ã‚±ãƒ¼ãƒ— â†’ 2é‡ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã«å¤‰æ›

3. **JSON Schemaæ¤œè¨¼ã®ç·©å’Œ**:
   - jobqueue APIã®Regexæ¤œè¨¼ã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–
   - ã¾ãŸã¯ã€ã‚ˆã‚Šå¯›å®¹ãªæ¤œè¨¼ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨

---

### èª²é¡Œ2: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå•é¡Œï¼ˆå„ªå…ˆåº¦: ğŸŸ¡ ä¸­ï¼‰

**å•é¡Œ**:
- Scenario 2, 3ãŒ600ç§’ï¼ˆ10åˆ†ï¼‰ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
- è¤‡é›‘ãªè¦æ±‚ã¸ã®å¯¾å¿œãŒå›°é›£

**åŸå› æ¨æ¸¬**:
1. **max_tokensè¨­å®šãŒéå¤§**:
   - ç¾åœ¨: 8192ãƒˆãƒ¼ã‚¯ãƒ³
   - æ¨å¥¨: 4096ãƒˆãƒ¼ã‚¯ãƒ³

2. **LLMãƒ¢ãƒ‡ãƒ«é¸æŠ**:
   - ç¾åœ¨: Claude Haiku 4.5ï¼ˆå…¨ãƒãƒ¼ãƒ‰ï¼‰
   - æ¨å¥¨: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æˆ¦ç•¥ï¼ˆHaiku + Sonnetï¼‰

3. **ãƒ­ã‚°å‡ºåŠ›ä¸è¶³**:
   - expertAgentã®è©³ç´°ãªãƒ­ã‚°ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ãªã„
   - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®åŸå› ç‰¹å®šãŒå›°é›£

**å¯¾ç­–æ¡ˆï¼ˆPhase 3ï¼‰**:
1. **max_tokensã®æœ€é©åŒ–**:
   - ã‚¿ã‚¹ã‚¯æ•°ã«å¿œã˜ãŸå‹•çš„èª¿æ•´ï¼ˆ2048 / 4096 / 8192ï¼‰

2. **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ‡ãƒ«æˆ¦ç•¥**:
   - requirement_analysis, task_breakdown: Haikuï¼ˆé«˜é€Ÿï¼‰
   - interface_definition, task_generation: Sonnetï¼ˆé«˜ç²¾åº¦ï¼‰
   - evaluation, validation: Haikuï¼ˆé«˜é€Ÿï¼‰

3. **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã®è¦‹ç›´ã—**:
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’600ç§’ â†’ 900ç§’ï¼ˆ15åˆ†ï¼‰ã«æ‹¡å¤§
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèª¿æ•´å¯èƒ½ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦å…¬é–‹

4. **ãƒ­ã‚®ãƒ³ã‚°å¼·åŒ–**:
   - å„ãƒãƒ¼ãƒ‰ã®å‡¦ç†æ™‚é–“ã‚’è¨˜éŒ²
   - LLMå‘¼ã³å‡ºã—ã®ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã‚’è¨˜éŒ²

---

## ğŸ¯ Phase 3ã¸ã®æ¨å¥¨äº‹é …

### å„ªå…ˆåº¦: ğŸ”´ æœ€é«˜

#### å¯¾ç­–A: Regexéå‰°ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã®ä¿®æ­£

**å·¥æ•°**: 30-45åˆ†

**å®Ÿæ–½å†…å®¹**:
1. `interface_schema.py` ã®Promptã‚’å†åº¦æ”¹å–„
2. LLMå‡ºåŠ›å¾Œã®Responseå¾Œå‡¦ç†ã‚’è¿½åŠ 
3. 4é‡ã‚¨ã‚¹ã‚±ãƒ¼ãƒ— â†’ 2é‡ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã®è‡ªå‹•å¤‰æ›

**å®Ÿè£…ä¾‹**:
```python
# expertAgent/aiagent/langgraph/jobTaskGeneratorAgents/nodes/interface_definition.py

def fix_regex_escaping(schema: dict) -> dict:
    """Fix over-escaped regex patterns in JSON Schema"""
    import re

    def fix_pattern(obj):
        if isinstance(obj, dict):
            for key, value in obj.items():
                if key == "pattern" and isinstance(value, str):
                    # Fix 4-level escaping: \\\\ -> \\
                    obj[key] = value.replace("\\\\\\\\", "\\\\")
                else:
                    fix_pattern(value)
        elif isinstance(obj, list):
            for item in obj:
                fix_pattern(item)
        return obj

    return fix_pattern(schema)

# After LLM response
for iface in response.interfaces:
    iface.input_schema = fix_regex_escaping(iface.input_schema)
    iface.output_schema = fix_regex_escaping(iface.output_schema)
```

---

### å„ªå…ˆåº¦: ğŸŸ¡ é«˜

#### å¯¾ç­–B: max_tokensã®æœ€é©åŒ–

**å·¥æ•°**: 15-20åˆ†

**å®Ÿæ–½å†…å®¹**:
- ã‚¿ã‚¹ã‚¯æ•°ã«å¿œã˜ãŸå‹•çš„èª¿æ•´ã‚’å®Ÿè£…

**å®Ÿè£…ä¾‹**:
```python
# expertAgent/aiagent/langgraph/jobTaskGeneratorAgents/nodes/interface_definition.py

task_count = len(task_breakdown)
if task_count <= 3:
    max_tokens = 2048
elif task_count <= 7:
    max_tokens = 4096
else:
    max_tokens = 8192

logger.info(f"Adjusted max_tokens to {max_tokens} for {task_count} tasks")
```

---

#### å¯¾ç­–C: ãƒ­ã‚®ãƒ³ã‚°å¼·åŒ–

**å·¥æ•°**: 20-30åˆ†

**å®Ÿæ–½å†…å®¹**:
1. å„ãƒãƒ¼ãƒ‰ã®å‡¦ç†æ™‚é–“ã‚’ãƒ­ã‚°å‡ºåŠ›
2. LLMå‘¼ã³å‡ºã—ã®ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã‚’è¨˜éŒ²
3. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆç™ºç”Ÿæ™‚ã®è©³ç´°æƒ…å ±ã‚’è¨˜éŒ²

**å®Ÿè£…ä¾‹**:
```python
import time

start_time = time.time()
response = await structured_model.ainvoke([user_prompt])
elapsed_time = time.time() - start_time

logger.info(
    f"LLM invocation completed: "
    f"model={model_name}, "
    f"elapsed_time={elapsed_time:.2f}s, "
    f"task_count={len(task_breakdown)}"
)
```

---

## ğŸ“ çµè«–

### âœ… Phase 2ã®æˆæœ

1. **æ ¹æœ¬åŸå› ã®è§£æ±º**:
   - `KeyError: 'id'` ã‚’å®Œå…¨ã«è§£æ¶ˆ
   - expertAgentã¯ interface_definitionæ®µéšã¾ã§åˆ°é”

2. **jobqueue APIã®ä¸€è²«æ€§å‘ä¸Š**:
   - 3ã¤ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ã‚­ãƒ¼ãƒã‚’çµ±ä¸€
   - å¾Œæ–¹äº’æ›æ€§ã‚’ä¿æŒ

3. **å®Ÿè¡Œæ™‚é–“ã®æ”¹å–„**:
   - Scenario 1ã§ç´„13%ã®çŸ­ç¸®

### âš ï¸ æ–°ãŸã«ç™ºè¦‹ã•ã‚ŒãŸèª²é¡Œ

1. **Regexéå‰°ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å•é¡Œ**:
   - LLMãŒ4é‡ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚’ç”Ÿæˆ
   - Phase 3ã§ã®å¯¾å¿œãŒå¿…è¦

2. **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå•é¡Œ**:
   - è¤‡é›‘ãªã‚·ãƒŠãƒªã‚ªã§600ç§’è¶…é
   - max_tokensã€ãƒ¢ãƒ‡ãƒ«é¸æŠã€ãƒ­ã‚®ãƒ³ã‚°ã®æ”¹å–„ãŒå¿…è¦

### ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

**Phase 3**: expertAgentã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã¨Regexä¿®æ­£

**å„ªå…ˆé †ä½**:
1. ğŸ”´ **æœ€é«˜**: Regexéå‰°ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã®ä¿®æ­£ï¼ˆå¯¾ç­–Aï¼‰
2. ğŸŸ¡ **é«˜**: max_tokensã®æœ€é©åŒ–ï¼ˆå¯¾ç­–Bï¼‰
3. ğŸŸ¡ **é«˜**: ãƒ­ã‚®ãƒ³ã‚°å¼·åŒ–ï¼ˆå¯¾ç­–Cï¼‰
4. ğŸŸ¢ **ä¸­**: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ‡ãƒ«æˆ¦ç•¥ï¼ˆPhase 4ï¼‰

---

## ğŸ“š å‚è€ƒæƒ…å ±

### ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

- `/tmp/scenario1_phase2_result.json` - Scenario 1ã®è©³ç´°çµæœ
- `/tmp/scenario2_phase2_result.json` - Scenario 2ã®è©³ç´°çµæœ
- `/tmp/scenario3_phase2_result.json` - Scenario 3ã®è©³ç´°çµæœ
- `/tmp/all_scenarios_phase2_results.json` - å…¨ã‚·ãƒŠãƒªã‚ªã®çµ±åˆçµæœ

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
# ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
python3 /tmp/run_scenario_tests.py

# å€‹åˆ¥ã‚·ãƒŠãƒªã‚ªã®ãƒ†ã‚¹ãƒˆ
curl -X POST http://127.0.0.1:8104/aiagent-api/v1/job-generator \
  -H 'Content-Type: application/json' \
  -d @/tmp/scenario1.json
```

### ãƒ­ã‚°ç¢ºèªã‚³ãƒãƒ³ãƒ‰

```bash
# expertAgentãƒ­ã‚°
tail -f /tmp/expertAgent_new.log

# jobqueueãƒ­ã‚°
tail -f /tmp/jobqueue.log
```

---

**ä½œæˆè€…**: Claude Code
**ãƒ¬ãƒãƒ¼ãƒˆå½¢å¼**: Markdown
**é–¢é€£Issue**: #97
**å‰å›ãƒ¬ãƒãƒ¼ãƒˆ**: [improvement-report-phase2.md](./improvement-report-phase2.md)
