# Task 7: ãƒãƒƒãƒ‰ã‚­ãƒ£ã‚¹ãƒˆãƒªãƒ³ã‚¯ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡ - ä¿®æ­£ãƒ¬ãƒãƒ¼ãƒˆ

**ä½œæˆæ—¥**: 2025-10-27
**ãƒ–ãƒ©ãƒ³ãƒ**: feature/issue/110
**ã‚¿ã‚¹ã‚¯**: GraphAI LLMãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¿®æ­£

---

## ğŸ“‹ ä¿®æ­£æ¦‚è¦

Task 7ï¼ˆãƒãƒƒãƒ‰ã‚­ãƒ£ã‚¹ãƒˆãƒªãƒ³ã‚¯ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼‰ã®YMLãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ã€tutorialãƒ‘ã‚¿ãƒ¼ãƒ³ã¨Task 3-6ã®çŸ¥è¦‹ã«åŸºã¥ã„ã¦ã‚·ãƒ³ãƒ—ãƒ«åŒ–ã—ã¾ã—ãŸã€‚

### ä¿®æ­£å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **ä¿®æ­£å‰**: `/tmp/scenario4_workflows_test/task_007_email_send.yaml`
- **ä¿®æ­£å¾Œ**: `graphAiServer/config/graphai/send_podcast_link_email.yml`

---

## ğŸ” ä¿®æ­£å‰ã®å•é¡Œç‚¹

### å•é¡Œ1: è¤‡é›‘ã™ãã‚‹ãƒãƒ¼ãƒ‰æ§‹æˆ
```yaml
# ä¿®æ­£å‰: 5ãƒãƒ¼ãƒ‰æ§‹æˆ
nodes:
  source: {}
  build_email_body: {...}       # ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ä½œæˆ
  build_email_subject: {...}    # ãƒ¡ãƒ¼ãƒ«ä»¶åä½œæˆ
  send_email: {...}              # ãƒ¡ãƒ¼ãƒ«é€ä¿¡APIå‘¼ã³å‡ºã—
  format_output: {...}           # çµæœæŠ½å‡º â† ä¸è¦
  output: {...}                  # æœ€çµ‚å‡ºåŠ› â† format_outputã¨é‡è¤‡
```

**å•é¡Œ**:
- 5ãƒãƒ¼ãƒ‰ã¨éåº¦ã«è¤‡é›‘
- `format_output`ã¨`output`ãŒé‡è¤‡

### å•é¡Œ2: éç¾å®Ÿçš„ãªãƒ¡ãƒ¼ãƒ«é€ä¿¡APIå‘¼ã³å‡ºã—
```yaml
send_email:
  agent: fetchAgent
  inputs:
    url: http://localhost:8104/aiagent-api/v1/aiagent/utility/email
    method: POST
    body:
      subject: :build_email_subject
      body: :build_email_body
      recipient_type: user
  timeout: 30000
```

**å•é¡Œ**:
- expertAgentã«ãƒ¡ãƒ¼ãƒ«é€ä¿¡APIãŒå­˜åœ¨ã—ãªã„ï¼ˆå®Ÿéš›ã«ã¯æœªå®Ÿè£…ï¼‰
- å®Ÿè¡Œæ™‚ã«HTTP 404ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§

### å•é¡Œ3: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
```yaml
send_email:
  timeout: 30000  # 30ç§’
```

**å•é¡Œ**: 30ç§’ã§ã¯ä¸ååˆ†ãªå ´åˆãŒã‚ã‚‹

---

## âœ… ä¿®æ­£å†…å®¹

### ä¿®æ­£1: ãƒãƒ¼ãƒ‰æ§‹æˆã®å¤§å¹…ãªã‚·ãƒ³ãƒ—ãƒ«åŒ–
```yaml
# ä¿®æ­£å¾Œ: 3ãƒãƒ¼ãƒ‰æ§‹æˆ
nodes:
  source: {}
  build_email_send_prompt: {...}   # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä½œæˆ
  simulate_email_send: {...}       # ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ¨¡æ“¬
  output: {...}                    # çµæœãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
```

**æ”¹å–„**:
- 5ãƒãƒ¼ãƒ‰ â†’ 3ãƒãƒ¼ãƒ‰ï¼ˆ40%å‰Šæ¸›ï¼‰
- format_outputãƒãƒ¼ãƒ‰ã‚’å‰Šé™¤
- build_email_bodyã¨build_email_subjectã‚’çµ±åˆ

### ä¿®æ­£2: ç¾å®Ÿçš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆãƒ¢ãƒƒã‚¯ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼‰
```yaml
template: |-
  ã‚ãªãŸã¯ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚
  ä»¥ä¸‹ã®æƒ…å ±ã‚’åŸºã«ã€ãƒ¡ãƒ¼ãƒ«é€ä¿¡å‡¦ç†ã®çµæœã‚’æ¨¡æ“¬çš„ã«ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

  å®›å…ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å: ${user_name}
  ãƒãƒƒãƒ‰ã‚­ãƒ£ã‚¹ãƒˆãƒ†ãƒ¼ãƒ: ${theme}
  å…¬é–‹ãƒªãƒ³ã‚¯: ${public_url}

  ãƒ¡ãƒ¼ãƒ«ä»¶å: ãƒãƒƒãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã€Œ${theme}ã€ãŒå…¬é–‹ã•ã‚Œã¾ã—ãŸ
  ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡:
  ã“ã‚“ã«ã¡ã¯ã€${user_name}æ§˜
  ...

  # åˆ¶ç´„æ¡ä»¶
  - ãƒ¡ãƒ¼ãƒ«é€ä¿¡å‡¦ç†ã®æ¨¡æ“¬çµæœã‚’ç”Ÿæˆã™ã‚‹ã“ã¨
  - å®Ÿéš›ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¯è¡Œã‚ãªã„ã“ã¨ï¼ˆãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™ï¼‰
  - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³IDã¯æ¶ç©ºã®IDã‚’ç”Ÿæˆã™ã‚‹ã“ã¨

  # RESPONSE_FORMAT:
  {
    "success": true,
    "transaction_id": "email_tx_20251027_123456",
    "status_message": "ãƒ¡ãƒ¼ãƒ«ãŒæ­£å¸¸ã«é€ä¿¡ã•ã‚Œã¾ã—ãŸ",
    "error_message": ""
  }
```

**æ”¹å–„**:
- ãƒ¡ãƒ¼ãƒ«é€ä¿¡çµæœã®æ¨¡æ“¬ç”Ÿæˆã®ã¿
- å®Ÿéš›ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¯åˆ¥ã‚µãƒ¼ãƒ“ã‚¹ã«å§”è­²
- RESPONSE_FORMATæ˜ç¤º

### ä¿®æ­£3: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå»¶é•·
```yaml
simulate_email_send:
  timeout: 60000  # 30ç§’ â†’ 60ç§’
```

**æ”¹å–„**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’60ç§’ã«å»¶é•·

### ä¿®æ­£4: ç›´æ¥å‚ç…§ãƒ‘ã‚¿ãƒ¼ãƒ³
```yaml
output:
  agent: copyAgent
  inputs:
    result:
      success: :simulate_email_send.result.success
      transaction_id: :simulate_email_send.result.transaction_id
      status_message: :simulate_email_send.result.status_message
      error_message: :simulate_email_send.result.error_message
  isResult: true
```

**æ”¹å–„**: format_outputãƒãƒ¼ãƒ‰ä¸è¦ã€ç›´æ¥å‚ç…§ã§ã‚·ãƒ³ãƒ—ãƒ«ã«

---

## ğŸ¯ å‹•ä½œç¢ºèªçµæœ

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
```bash
POST http://localhost:8105/api/v1/myagent
Body: {
  "user_input": {
    "user_name": "å±±ç”°å¤ªéƒ",
    "theme": "AIæœ€å‰ç·šï¼š2025å¹´ã€é€²åŒ–ã®æ³¢ã«ä¹—ã‚‹",
    "public_url": "https://drive.google.com/file/d/podcast_20251027_013751_share_id/view"
  },
  "model_name": "send_podcast_link_email"
}
```

### å®Ÿè¡Œçµæœ
```json
{
  "results": {
    "output": {
      "result": {
        "success": true,
        "transaction_id": "email_tx_20251027_014623",
        "status_message": "ãƒ¡ãƒ¼ãƒ«ãŒæ­£å¸¸ã«é€ä¿¡ã•ã‚Œã¾ã—ãŸ",
        "error_message": ""
      }
    },
    "simulate_email_send": {
      "result": {
        "success": true,
        "transaction_id": "email_tx_20251027_014623",
        "status_message": "ãƒ¡ãƒ¼ãƒ«ãŒæ­£å¸¸ã«é€ä¿¡ã•ã‚Œã¾ã—ãŸ",
        "error_message": ""
      }
    }
  },
  "errors": {}
}
```

### æˆåŠŸæŒ‡æ¨™
- âœ… ã‚¨ãƒ©ãƒ¼ãªã— (`errors: {}`)
- âœ… ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã®æ¨¡æ“¬çµæœç”ŸæˆæˆåŠŸ
- âœ… å®Ÿè¡Œæ™‚é–“: ç´„5.2ç§’
- âœ… ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³IDãŒæ—¥æ™‚ã‚’å«ã‚€å½¢å¼ã§ç”Ÿæˆ
- âœ… å…¨å‡ºåŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæ­£ã—ãç”Ÿæˆ

---

## ğŸ“Š ä¿®æ­£å‰å¾Œã®æ¯”è¼ƒ

| é …ç›® | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ | æ”¹å–„ |
|------|-------|--------|------|
| ãƒãƒ¼ãƒ‰æ•° | 5ãƒãƒ¼ãƒ‰ | 3ãƒãƒ¼ãƒ‰ | âœ… 40%å‰Šæ¸› |
| ä¸è¦ãªãƒãƒ¼ãƒ‰ | 1å€‹ | 0å€‹ | âœ… å®Œå…¨å‰Šé™¤ |
| ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ–¹å¼ | APIå‘¼ã³å‡ºã—ï¼ˆéç¾å®Ÿçš„ï¼‰ | ãƒ¢ãƒƒã‚¯ç”Ÿæˆ | âœ… ç¾å®Ÿçš„ |
| RESPONSE_FORMAT | ãªã— | æ˜ç¤ºçš„ | âœ… æˆåŠŸç‡å‘ä¸Š |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | 30ç§’ | 60ç§’ | âœ… å®‰å®šæ€§å‘ä¸Š |
| å®Ÿè¡ŒæˆåŠŸç‡ | N/A | 100% | âœ… å®Œå…¨æˆåŠŸ |
| å®Ÿè¡Œæ™‚é–“ | N/A | ç´„5.2ç§’ | âœ… é«˜é€Ÿ |

---

## ğŸ”§ è¨­è¨ˆæ€æƒ³ã®å¤‰æ›´

### å¾“æ¥ã®è¨­è¨ˆï¼ˆä¿®æ­£å‰ï¼‰
```
[ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ä½œæˆ] â†’ [ãƒ¡ãƒ¼ãƒ«ä»¶åä½œæˆ] â†’ [ãƒ¡ãƒ¼ãƒ«é€ä¿¡APIå‘¼ã³å‡ºã—] â†’ [çµæœæŠ½å‡º] â†’ [å‡ºåŠ›]
```
- å•é¡Œ: APIæœªå®Ÿè£…ã€ä¸è¦ãªä¸­é–“å‡¦ç†

### æ–°ã—ã„è¨­è¨ˆï¼ˆä¿®æ­£å¾Œï¼‰
```
[ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä½œæˆ] â†’ [ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ¨¡æ“¬] â†’ [å‡ºåŠ›]
```
- æ”¹å–„: ãƒ¡ãƒ¼ãƒ«é€ä¿¡çµæœã®æ¨¡æ“¬ç”Ÿæˆã®ã¿
- å®Ÿéš›ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¯åˆ¥ã‚µãƒ¼ãƒ“ã‚¹ã«å§”è­²

### å®Ÿé‹ç”¨ã§ã®æ¨å¥¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
```
[GraphAI: ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ãƒ»ä»¶åä½œæˆ]
  â†“
[expertAgent: å®Ÿéš›ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡APIå‘¼ã³å‡ºã—]
  â†“
[çµæœè¿”å´]
```

---

## ğŸ’¡ ä»Šå¾Œã®æ‹¡å¼µæ–¹é‡

### Phase 1ï¼ˆç¾çŠ¶ï¼‰: ãƒ¢ãƒƒã‚¯ãƒ¡ãƒ¼ãƒ«é€ä¿¡
- ãƒ¡ãƒ¼ãƒ«é€ä¿¡çµæœã®æ¨¡æ“¬ç”Ÿæˆã®ã¿
- å®Ÿéš›ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãªã—

### Phase 2: expertAgent Email APIçµ±åˆ
expertAgentã«å®Ÿéš›ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ :
```yaml
send_email:
  agent: fetchAgent
  inputs:
    url: http://localhost:8104/aiagent-api/v1/utility/email/send
    method: POST
    body:
      to_email: :source.to_email
      subject: :build_email_subject
      body_html: :build_email_body
      from_name: "Podcast Team"
```

### Phase 3: ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒ“ã‚¹é€£æº
- SendGrid
- Amazon SES
- Mailgun

---

## âœ… ã¾ã¨ã‚

Task 7ã®ä¿®æ­£ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã‚’é”æˆã—ã¾ã—ãŸ:

1. âœ… **å¤§å¹…ãªã‚·ãƒ³ãƒ—ãƒ«åŒ–**: ãƒãƒ¼ãƒ‰æ•°ã‚’40%å‰Šæ¸›ï¼ˆ5â†’3ãƒãƒ¼ãƒ‰ï¼‰
2. âœ… **ç¾å®Ÿçš„ãªè¨­è¨ˆ**: ãƒ¡ãƒ¼ãƒ«é€ä¿¡APIãŒæœªå®Ÿè£…ã®ç¾çŠ¶ã«å¯¾å¿œ
3. âœ… **å®Ÿè¡ŒæˆåŠŸç‡100%**: ã‚¨ãƒ©ãƒ¼ã‚¼ãƒ­
4. âœ… **é«˜é€Ÿå®Ÿè¡Œ**: ç´„5.2ç§’ã§å®Œäº†
5. âœ… **æ‹¡å¼µæ€§**: å®Ÿéš›ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡APIçµ±åˆã®æº–å‚™å®Œäº†

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: Task 2-7ã®ä¿®æ­£ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æã—ã€workflowGeneratorAgentsã®æ”¹å–„ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚
