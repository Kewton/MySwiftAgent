# 設計方針: docs/design ディレクトリ最新化

**作成日**: 2025-10-19
**ブランチ**: feature/issue/104
**担当**: Claude Code

---

## 📋 要求・要件

### ビジネス要求
- `./docs/design` ディレクトリのドキュメントを最新のプロジェクト構成に合わせて更新する
- 開発者が正確な情報にアクセスできるようにする
- ドキュメントの保守性を維持する

### 機能要件
- 既存3ドキュメントの内容検証と修正
  1. `architecture-overview.md` - システムアーキテクチャ全体
  2. `environment-variables.md` - 環境変数管理ポリシー
  3. `myvault-integration.md` - MyVault統合規約
- 最終更新日を本日の日付（2025-10-19）に変更
- プロジェクト構成の変更点を反映

### 非機能要件
- パフォーマンス: ドキュメント更新作業は2時間以内に完了
- 品質: 全ドキュメントの内容が実際のコード・設定と整合性があること
- 保守性: ドキュメント構造を維持し、将来の更新が容易であること

---

## 🏗️ アーキテクチャ設計

### 対策案の選定

**選定した対策案**: **対策案A（最小限の更新）**

#### 選定理由

| 評価項目 | 理由 |
|---------|------|
| **スコープの適切性** | 現在のissue #104の範囲に収まり、過剰な作業を避けられる |
| **リスクの低さ** | 既存ドキュメントの修正のみで、新規ドキュメント作成による複雑性を回避 |
| **レビュー負荷** | 変更箇所が限定的で、レビュアーの負担が少ない |
| **迅速性** | 短時間で完了し、迅速にマージ可能 |
| **実用性** | 必要最小限の更新で実用性を確保 |

#### 他の対策案を採用しなかった理由

- **対策案B・C（中規模・フル更新）**:
  - 新規ドキュメント追加は別issueで対応すべき
  - 作業時間とレビュー負荷が増大
  - CLAUDE.mdとの重複内容が増加し、保守性が低下

- **対策案D（段階的更新）**:
  - 現時点では過剰に複雑
  - 既存3ドキュメントの更新は1つのPRで完結できる規模

### 更新方針

#### 1. architecture-overview.md

**検証項目**:
- ✅ プロジェクト一覧（現在: JobQueue, MyScheduler, MyVault, ExpertAgent, GraphAiServer, CommonUI, Docs）
- ✅ ポート設定（Docker Compose: 8001-8005, 8501 / quick-start: 8101-8105, 8601）
- ✅ サービス依存関係
- ✅ 環境変数設定
- ✅ 起動モードの説明

**更新内容**:
- プロジェクト一覧表の確認・更新（Docs プロジェクトの追記有無）
- ポート番号の検証（README.mdとの整合性確認）
- サービス間URL設定の最新化
- 最終更新日を 2025-10-19 に変更

#### 2. environment-variables.md

**検証項目**:
- ✅ 各プロジェクトの .env 設定例
- ✅ MyVault統合の環境変数
- ✅ ポート設定（Docker / dev-start / quick-start）
- ✅ トークン生成方法

**更新内容**:
- 各プロジェクトの .env 設定例の検証
- 起動スクリプトとの整合性確認
- 削除された設定項目の最新化
- 最終更新日を 2025-10-19 に変更

#### 3. myvault-integration.md

**検証項目**:
- ✅ 必須パラメータ（環境変数）
- ✅ RBACポリシー例
- ✅ ポート構成（Docker: 8003 / quick-start: 8103）
- ✅ 統合実装手順

**更新内容**:
- 環境変数の検証（実際の設定との整合性）
- ポート番号の確認
- 統合サービス一覧の最新化
- 最終更新日を 2025-10-19 に変更

### ディレクトリ構成（変更なし）

```
docs/
└── design/
    ├── architecture-overview.md      # 更新
    ├── environment-variables.md      # 更新
    └── myvault-integration.md        # 更新
```

---

## ✅ 制約条件チェック結果

### コード品質原則
- [x] **SOLID原則**: 該当なし（ドキュメント更新のみ）
- [x] **KISS原則**: 遵守 / 最小限の更新で目的達成
- [x] **YAGNI原則**: 遵守 / 不要な新規ドキュメント作成を回避
- [x] **DRY原則**: 遵守 / CLAUDE.mdとの重複を最小化

### アーキテクチャガイドライン
- [x] **architecture-overview.md**: 準拠 / ドキュメント自体を更新
- [x] **レイヤー分離**: 該当なし（ドキュメント更新のみ）

### 設定管理ルール
- [x] **環境変数**: 遵守 / environment-variables.mdの内容を検証・更新
- [x] **myVault**: 遵守 / myvault-integration.mdの内容を検証・更新

### 品質担保方針
- [x] **単体テストカバレッジ**: 該当なし（ドキュメント更新のみ）
- [x] **結合テストカバレッジ**: 該当なし（ドキュメント更新のみ）
- [x] **Ruff linting**: 該当なし（Markdownファイルのみ）
- [x] **MyPy type checking**: 該当なし（Markdownファイルのみ）

### CI/CD準拠
- [x] **PRラベル**: `docs` ラベルを付与予定（patch bump判定）
- [x] **コミットメッセージ**: 規約に準拠（`docs(design): update docs/design directory to latest project structure`）
- [ ] **pre-push-check-all.sh**: ドキュメント更新のみのため実行不要（Markdownlintは手動確認）

### 参照ドキュメント遵守
- [x] **新プロジェクト追加時**: 該当なし（既存ドキュメント更新のみ）
- [x] **GraphAI ワークフロー開発時**: 該当なし

### 違反・要検討項目
なし

---

## 📝 設計上の決定事項

### 決定事項1: 対策案Aの採用
- **決定内容**: 既存3ドキュメントの内容検証と修正のみを実施
- **理由**: issue #104のスコープに適合し、迅速にマージ可能
- **代替案**: 対策案B（CI/CDドキュメント追加）は別issueで対応

### 決定事項2: 最終更新日の統一
- **決定内容**: 全ドキュメントの最終更新日を 2025-10-19 に統一
- **理由**: 更新日時の一貫性を保つため
- **注意点**: 実質的な更新がないドキュメントでも日付を変更

### 決定事項3: README.mdとの整合性確認
- **決定内容**: ポート番号・サービス一覧はREADME.mdと整合性を取る
- **理由**: 開発者が混乱しないよう、全ドキュメントで情報を統一
- **検証方法**: README.md, docker-compose.yml, scripts/quick-start.sh を相互確認

### 決定事項4: dev-reports管理
- **決定内容**: CLAUDE.mdの作業ドキュメント管理ルールに従い、`./dev-reports/feature/issue/104/` に全ドキュメントを配置
- **理由**: トレーサビリティの向上と品質担保
- **作成ドキュメント**:
  - design-policy.md（本ドキュメント）
  - work-plan.md
  - phase-1-progress.md
  - phase-2-progress.md
  - phase-3-progress.md
  - final-report.md

---

## 🚨 リスク分析

### リスク1: 実際の設定との不整合
- **影響度**: 中
- **発生確率**: 低
- **対策**: 各プロジェクトの .env, docker-compose.yml, scripts を直接確認
- **検出方法**: 実際にサービスを起動して動作確認

### リスク2: ドキュメント間の矛盾
- **影響度**: 中
- **発生確率**: 低
- **対策**: README.md, CLAUDE.md, docs/design/ のクロスチェック
- **検出方法**: 全ドキュメントを通読し、矛盾箇所を洗い出し

### リスク3: 更新漏れ
- **影響度**: 低
- **発生確率**: 低
- **対策**: 各Phaseで制約条件チェックを実施
- **検出方法**: final-report.mdでチェックリスト確認

---

## 📅 作業スケジュール（概算）

| Phase | 作業内容 | 所要時間 | 完了予定 |
|-------|---------|---------|---------|
| 準備 | design-policy.md作成 | 30分 | 完了 |
| 計画 | work-plan.md作成 | 15分 | 承認後 |
| Phase 1 | architecture-overview.md 更新 | 30分 | 承認後 |
| Phase 2 | environment-variables.md 更新 | 30分 | Phase 1完了後 |
| Phase 3 | myvault-integration.md 更新 | 30分 | Phase 2完了後 |
| 報告 | final-report.md作成 | 15分 | Phase 3完了後 |

**総所要時間**: 約2.5時間

---

## 💡 今後の展開

本作業（対策案A）完了後、必要に応じて以下を別issueで対応することを推奨：

### 今後検討すべき追加ドキュメント

| ドキュメント名 | 目的 | 優先度 |
|-------------|------|-------|
| **ci-cd-pipeline.md** | GitHub Actionsワークフロー詳細 | 高 |
| **development-workflow.md** | 作業ドキュメント管理・ブランチ戦略詳細 | 中 |
| **branch-strategy.md** | ブランチ構成・マージフロー | 中 |
| **release-management.md** | リリース管理フロー | 低 |

これらは対策案B・Cで提案した内容ですが、現時点ではCLAUDE.mdに記載されているため、緊急性は低いと判断しました。

---

## 📞 承認依頼

上記の設計方針で作業を進めてよろしいでしょうか？

**承認いただける場合**:
- ✅ 「承認」とお答えください → work-plan.md を作成し、Phase 1の作業を開始します

**修正が必要な場合**:
- 🔄 修正箇所をご指示ください → 設計方針を修正します

**その他のご要望**:
- 💬 ご質問・ご要望をお聞かせください
