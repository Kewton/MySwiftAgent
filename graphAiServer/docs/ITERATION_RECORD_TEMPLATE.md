# ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨˜éŒ²ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**æœ€çµ‚æ›´æ–°**: 2025-10-14
**å¯¾è±¡**: Gemini CLI / Claude Code

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€GraphAI ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é–‹ç™ºã«ãŠã‘ã‚‹å„ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨˜éŒ²ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã™ã€‚
ãƒ‡ãƒãƒƒã‚°åŠ¹ç‡ã‚’æœ€å¤§åŒ–ã—ã€ã‚¨ãƒ©ãƒ¼ã®å†ç™ºã‚’é˜²æ­¢ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚

---

## ğŸ“‹ ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨˜éŒ²ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ N

#### å®Ÿè¡Œæƒ…å ±
- **å®Ÿè¡Œæ—¥æ™‚**: YYYY-MM-DD HH:MM:SS
- **YMLãƒãƒ¼ã‚¸ãƒ§ãƒ³**: vX.Y.Z
- **å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰**:
  ```bash
  curl -X POST http://127.0.0.1:8105/api/v1/myagent/llmwork/{filename} \
    -H "Content-Type: application/json" \
    -d '{"user_input": "..."}'
  ```

#### ãƒ†ã‚¹ãƒˆå…¥åŠ›
```json
{
  "user_input": "[å…·ä½“çš„ãªå…¥åŠ›å†…å®¹]"
}
```

---

#### ğŸ“Š GraphAI APIãƒ¬ã‚¹ãƒãƒ³ã‚¹åˆ†æ

##### âœ… æˆåŠŸã—ãŸãƒãƒ¼ãƒ‰
| ãƒãƒ¼ãƒ‰å | å®Ÿéš›ã®å‡ºåŠ› | æœŸå¾…å€¤ã¨ã®æ¯”è¼ƒ |
|---------|-----------|--------------|
| `node1` | `[å‡ºåŠ›å†…å®¹]` | âœ… æœŸå¾…é€šã‚Š |
| `node2` | `[å‡ºåŠ›å†…å®¹]` | âœ… æœŸå¾…é€šã‚Š |

##### âŒ å¤±æ•—ã—ãŸãƒãƒ¼ãƒ‰
| ãƒãƒ¼ãƒ‰å | æœŸå¾…å€¤ | å®Ÿéš›ã®å‡ºåŠ› | å·®åˆ† |
|---------|-------|-----------|------|
| `problem_node` | `["string1", "string2"]` | `[object Object]` | å‹ä¸ä¸€è‡´ |

##### ğŸ” ä¸­é–“ãƒãƒ¼ãƒ‰ã®è©³ç´°åˆ†æ

**ãƒãƒ¼ãƒ‰å**: `mapAgent_node`

**APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã® `results` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:
```json
{
  "mapAgent_node": [
    {
      "node1": "...",
      "node2": "..."
    }
  ]
}
```

**æœŸå¾…ã—ã¦ã„ãŸå‡ºåŠ›å½¢å¼**:
```json
{
  "mapAgent_node": {
    "isResultNodeName": ["...", "..."]
  }
}
```

**å·®åˆ†ã®åŸå› **:
- `compositeResult: true` ãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„
- ã‚µãƒ–ã‚°ãƒ©ãƒ•ã« `isResult: true` ãŒè¤‡æ•°ã‚ã‚‹

---

#### ğŸ› ã‚¨ãƒ©ãƒ¼è¨ºæ–­

##### ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡
- [ ] `[object Object]` ã‚¨ãƒ©ãƒ¼
- [ ] `UNDEFINED` ã‚¨ãƒ©ãƒ¼
- [ ] Silent Failureï¼ˆãƒ‡ãƒ¼ã‚¿æé€ ï¼‰
- [ ] HTTP 500 ã‚¨ãƒ©ãƒ¼
- [ ] ãã®ä»–: [å…·ä½“çš„ãªã‚¨ãƒ©ãƒ¼]

##### æ ¹æœ¬åŸå› 
[ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸç†ç”±ã‚’è¨˜è¼‰]

ä¾‹:
- mapAgentã« `compositeResult: true` ãŒæœªæŒ‡å®š
- å¾Œç¶šãƒãƒ¼ãƒ‰ã§ `:mapAgentãƒãƒ¼ãƒ‰å.isResultãƒãƒ¼ãƒ‰å` å‚ç…§ãŒå¿…è¦ãªã®ã« `:mapAgentãƒãƒ¼ãƒ‰å` ã§å‚ç…§
- LLMã«ç ´æãƒ‡ãƒ¼ã‚¿ï¼ˆ`[object Object]`ï¼‰ãŒæ¸¡ã•ã‚Œã€Hallucination ãŒç™ºç”Ÿ

##### å½±éŸ¿ç¯„å›²
| ãƒãƒ¼ãƒ‰å | å½±éŸ¿åº¦ | èª¬æ˜ |
|---------|-------|------|
| `node1` | ğŸ”´ Critical | å®Œå…¨ã«å¤±æ•— |
| `node2` | ğŸŸ¡ Medium | ãƒ‡ãƒ¼ã‚¿ç ´æ |
| `node3` | ğŸŸ¢ Low | å¾Œç¶šå‡¦ç†ã§å¸åå¯èƒ½ |

---

#### ğŸ”§ é©ç”¨ã—ãŸä¿®æ­£

##### ä¿®æ­£å†…å®¹
**ä¿®æ­£ç®‡æ‰€**: [ãƒ•ã‚¡ã‚¤ãƒ«å:è¡Œç•ªå·]

**Before**:
```yaml
process_items:
  agent: mapAgent
  inputs:
    rows: :previous_node
  graph:
    nodes:
      format_result:
        agent: stringTemplateAgent
        isResult: true
```

**After**:
```yaml
process_items:
  agent: mapAgent
  console:
    after: true  # â† ãƒ‡ãƒãƒƒã‚°ç”¨ã«è¿½åŠ 
  params:
    compositeResult: true  # â† è¿½åŠ 
  inputs:
    rows: :previous_node
  graph:
    nodes:
      format_result:
        agent: stringTemplateAgent
        isResult: true

# å¾Œç¶šãƒãƒ¼ãƒ‰ã‚‚ä¿®æ­£
next_node:
  agent: arrayJoinAgent
  inputs:
    array: :process_items.format_result  # â† ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¢ã‚¯ã‚»ã‚¹ã«å¤‰æ›´
```

##### ä¿®æ­£ã®ç†ç”±
[ãªãœã“ã®ä¿®æ­£ãŒå¿…è¦ã ã£ãŸã®ã‹]

ä¾‹:
- mapAgentã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã§ã¯ã€ã‚µãƒ–ã‚°ãƒ©ãƒ•ã®å…¨ãƒãƒ¼ãƒ‰å‡ºåŠ›ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…åˆ—ã¨ã—ã¦è¿”ã™
- `compositeResult: true` ã«ã‚ˆã‚Šã€`isResult: true` ã®ãƒãƒ¼ãƒ‰ã®ã¿ã‚’æŠ½å‡ºã—ã¦ `{ "ãƒãƒ¼ãƒ‰å": [...] }` å½¢å¼ã§è¿”ã™
- ã“ã‚Œã«ã‚ˆã‚Šå¾Œç¶šãƒãƒ¼ãƒ‰ã§é…åˆ—ã‚’æ­£ã—ãå‚ç…§ã§ãã‚‹

---

#### âœ… æ¤œè¨¼çµæœ

##### ä¿®æ­£å¾Œã®å‹•ä½œç¢ºèª

**APIãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "results": {
    "process_items": {
      "format_result": ["string1", "string2", "string3"]
    },
    "next_node": "string1\nstring2\nstring3"
  },
  "errors": {}
}
```

**æ¤œè¨¼é …ç›®**:
- [x] mapAgentã®å‡ºåŠ›å½¢å¼ãŒ `{ "isResultãƒãƒ¼ãƒ‰å": [...] }` ã«ãªã£ã¦ã„ã‚‹
- [x] å¾Œç¶šãƒãƒ¼ãƒ‰ã§é…åˆ—ã‚’æ­£ã—ãå‚ç…§ã§ãã¦ã„ã‚‹
- [x] `[object Object]` ã‚¨ãƒ©ãƒ¼ãŒè§£æ¶ˆã•ã‚Œã¦ã„ã‚‹
- [x] æœ€çµ‚å‡ºåŠ›ãŒæœŸå¾…é€šã‚Šã®å†…å®¹ã«ãªã£ã¦ã„ã‚‹
- [x] ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒç©ºã§ã‚ã‚‹

##### æ®‹å­˜ã™ã‚‹å•é¡Œ
- [å•é¡ŒãŒã‚ã‚Œã°è¨˜è¼‰ã€ãªã‘ã‚Œã°ã€Œãªã—ã€]

---

#### ğŸ“ å­¦ã‚“ã æ•™è¨“

##### æŠ€è¡“çš„ãªå­¦ã³
1. [å­¦ã³1]
2. [å­¦ã³2]

ä¾‹:
1. mapAgentã§é…åˆ—ã‚’è¿”ã—ãŸã„å ´åˆã¯å¿…ãš `compositeResult: true` ã‚’æŒ‡å®šã™ã‚‹
2. ã‚µãƒ–ã‚°ãƒ©ãƒ•å†…ã®è¤‡æ•°ãƒãƒ¼ãƒ‰ã« `isResult: true` ãŒã‚ã‚‹ã¨ã€æœ€åˆã®1ã¤ã®ã¿ãŒå‡ºåŠ›ã•ã‚Œã‚‹
3. APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã® `results` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¦‹ã‚‹ã“ã¨ã§ã€ä¸­é–“ãƒãƒ¼ãƒ‰ã®å‡ºåŠ›ã‚’æ­£ç¢ºã«æŠŠæ¡ã§ãã‚‹

##### ãƒ‡ãƒãƒƒã‚°æ‰‹æ³•
1. [æ‰‹æ³•1]
2. [æ‰‹æ³•2]

ä¾‹:
1. ã¾ãš APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã® `results` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å…¨ä½“ã‚’ç¢ºèª
2. å•é¡Œã®ãƒãƒ¼ãƒ‰ã« `console.after: true` ã‚’è¿½åŠ ã—ã¦ãƒ­ã‚°å‡ºåŠ›
3. æœŸå¾…å€¤ã¨å®Ÿéš›ã®å€¤ã‚’ JSONå½¢å¼ã§æ¯”è¼ƒ

##### äºˆé˜²ç­–
1. [äºˆé˜²ç­–1]
2. [äºˆé˜²ç­–2]

ä¾‹:
1. mapAgentä½¿ç”¨æ™‚ã¯å¿…ãš `compositeResult: true` ã‚’ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã«è¿½åŠ 
2. é‡è¦ãªãƒãƒ¼ãƒ‰ã«ã¯æœ€åˆã‹ã‚‰ `console.after: true` ã‚’è¨­å®š
3. YMLãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚³ãƒ¡ãƒ³ãƒˆã§å‡ºåŠ›å½¢å¼ã‚’æ˜è¨˜

---

#### â±ï¸ æ‰€è¦æ™‚é–“
- **ä¿®æ­£æ™‚é–“**: [N]åˆ†
- **æ¤œè¨¼æ™‚é–“**: [N]åˆ†
- **åˆè¨ˆ**: [N]åˆ†

---

## ğŸ¯ ãƒ‡ãƒãƒƒã‚°ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### åˆæœŸç¢ºèªï¼ˆå¿…é ˆï¼‰
- [ ] GraphAI APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã® `results` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä¿å­˜ã—ãŸ
- [ ] `errors` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒç©ºã‹ç¢ºèªã—ãŸ
- [ ] å•é¡Œã®ãƒãƒ¼ãƒ‰ã‚’ç‰¹å®šã—ãŸ

### mapAgentä½¿ç”¨æ™‚
- [ ] `compositeResult: true` ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ã‚µãƒ–ã‚°ãƒ©ãƒ•ã« `isResult: true` ãŒ1ã¤ã ã‘ã‚ã‚‹ã‹
- [ ] å¾Œç¶šãƒãƒ¼ãƒ‰ã§ `:mapAgentãƒãƒ¼ãƒ‰å.isResultãƒãƒ¼ãƒ‰å` å½¢å¼ã§å‚ç…§ã—ã¦ã„ã‚‹ã‹
- [ ] `console.after: true` ã§ãƒ­ã‚°å‡ºåŠ›ã‚’æœ‰åŠ¹åŒ–ã—ãŸã‹

### arrayJoinAgentä½¿ç”¨æ™‚
- [ ] å…¥åŠ›ãŒæ–‡å­—åˆ—é…åˆ—ã«ãªã£ã¦ã„ã‚‹ã‹ï¼ˆ`["str1", "str2"]`ï¼‰
- [ ] ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…åˆ—ï¼ˆ`[{...}, {...}]`ï¼‰ã‚’æ¸¡ã—ã¦ã„ãªã„ã‹
- [ ] `[object Object]` ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ãªã„ã‹

### LLMã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½¿ç”¨æ™‚
- [ ] å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒç ´æã—ã¦ã„ãªã„ã‹ï¼ˆSilent Failureé˜²æ­¢ï¼‰
- [ ] ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§æœŸå¾…ã™ã‚‹å‡ºåŠ›å½¢å¼ã‚’æ˜ç¤ºã—ã¦ã„ã‚‹ã‹
- [ ] å‡ºåŠ›ãŒå…ƒãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ã„ã‚‹ã‹æ¤œè¨¼ã—ãŸã‹

### æœ€çµ‚ç¢ºèª
- [ ] å…¨ãƒãƒ¼ãƒ‰ãŒæ­£å¸¸çµ‚äº†ã—ãŸã‹ï¼ˆ`errors` ãŒç©ºï¼‰
- [ ] æœ€çµ‚å‡ºåŠ›ãŒæœŸå¾…é€šã‚Šã®å½¢å¼ã‹
- [ ] æœ€çµ‚å‡ºåŠ›ãŒå…ƒãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ã„ã‚‹ã‹
- [ ] å‡¦ç†æ™‚é–“ãŒè¨±å®¹ç¯„å›²å†…ã‹

---

## ğŸ“Š ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒãƒªãƒ¼ï¼ˆè¤‡æ•°å›å®Ÿè¡Œæ™‚ï¼‰

### çµ±è¨ˆæƒ…å ±
| ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ä¸»ãªã‚¨ãƒ©ãƒ¼ | ä¿®æ­£å†…å®¹ | æ‰€è¦æ™‚é–“ |
|--------------|-----------|-----------|---------|---------|
| 1 | âŒ FAILED | `[object Object]` | JSON parsingè©¦è¡Œ | 15åˆ† |
| 2 | âŒ FAILED | `UNDEFINED` | PropertyæŠ½å‡ºè©¦è¡Œ | 20åˆ† |
| 3 | âœ… SUCCESS | ãªã— | `compositeResult: true` è¿½åŠ  | 10åˆ† |

### ç´¯ç©å­¦ç¿’
1. [ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã‚’é€šã˜ã¦å¾—ã‚‰ã‚ŒãŸçŸ¥è¦‹]
2. [åŠ¹æœçš„ã ã£ãŸãƒ‡ãƒãƒƒã‚°æ‰‹æ³•]
3. [æ¬¡å›ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é–‹ç™ºã«æ´»ã‹ã›ã‚‹æ•™è¨“]

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **é–‹ç™ºãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**: `./graphAiServer/docs/WORKFLOW_DEVELOPMENT_TEMPLATE.md`
- **GraphAIãƒ«ãƒ¼ãƒ«**: `./graphAiServer/docs/GRAPHAI_WORKFLOW_GENERATION_RULES.md`
- **YMLãƒ•ã‚¡ã‚¤ãƒ«**: `./graphAiServer/config/graphai/llmwork/{workflow_name}.yml`

---

## âš™ï¸ APIãƒ¬ã‚¹ãƒãƒ³ã‚¹è¨˜éŒ²æ–¹æ³•

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¿å­˜ã‚³ãƒãƒ³ãƒ‰
```bash
curl -X POST http://127.0.0.1:8105/api/v1/myagent/llmwork/{filename} \
  -H "Content-Type: application/json" \
  -d '{"user_input": "..."}' \
  | jq '.' > ./workspace/geminicli/{workflow_name}/iteration-{N}-response.json
```

### é‡è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æŠ½å‡º
```bash
# resultsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿æŠ½å‡º
jq '.results' iteration-{N}-response.json

# ç‰¹å®šãƒãƒ¼ãƒ‰ã®å‡ºåŠ›ã®ã¿æŠ½å‡º
jq '.results.node_name' iteration-{N}-response.json

# errorsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿æŠ½å‡º
jq '.errors' iteration-{N}-response.json
```

### å·®åˆ†æ¯”è¼ƒ
```bash
# æœŸå¾…å€¤ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã®æ¯”è¼ƒ
diff <(jq -S '.results.node_name' expected.json) \
     <(jq -S '.results.node_name' iteration-{N}-response.json)
```

---

**æœ€çµ‚æ›´æ–°**: 2025-10-14
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
